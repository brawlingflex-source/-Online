<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>–°–±–µ—Ä–±–∞–Ω–∫ ‚Ä¢ –î–≤–∞ –∞–∫–∫–∞—É–Ω—Ç–∞</title>
    <!-- Firebase SDK (8-—è compat-–≤–µ—Ä—Å–∏—è) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Roboto, system-ui, -apple-system, sans-serif;
            background: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            transition: background 0.2s;
        }

        body.dark-theme {
            background: #121212;
            color: #e0e0e0;
        }

        #app {
            width: 100%;
            max-width: 420px;
            margin: 0 auto;
            background: white;
            border-radius: 32px 32px 0 0;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            min-height: 700px;
            display: flex;
            flex-direction: column;
            transition: background 0.2s, color 0.2s;
        }

        body.dark-theme #app {
            background: #1e1e1e;
            color: #f0f0f0;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        .header {
            background: #1a7742;
            color: white;
            padding: 24px 20px 20px;
            border-bottom-left-radius: 24px;
            border-bottom-right-radius: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        body.dark-theme .header {
            background: #0d4b2b;
        }

        .header h2 {
            font-weight: 500;
            font-size: 1.4rem;
        }

        .theme-switch {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 30px;
            font-size: 0.9rem;
            display: flex;
            gap: 6px;
            cursor: pointer;
            backdrop-filter: blur(4px);
        }

        .content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .account-selector {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-top: 40px;
        }

        .account-card {
            background: #f9f9f9;
            border-radius: 24px;
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: 0.2s;
            cursor: pointer;
            border: 2px solid transparent;
        }

        body.dark-theme .account-card {
            background: #2d2d2d;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .account-card:hover {
            border-color: #1a7742;
        }

        .avatar {
            width: 56px;
            height: 56px;
            border-radius: 28px;
            background: #1a7742;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
        }

        .account-info h3 {
            font-size: 1.4rem;
            font-weight: 500;
        }

        .account-info p {
            color: #666;
            font-size: 0.9rem;
        }

        body.dark-theme .account-info p {
            color: #aaa;
        }

        .btn {
            background: #1a7742;
            border: none;
            color: white;
            padding: 14px 24px;
            border-radius: 40px;
            font-size: 1rem;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            transition: 0.2s;
            margin-bottom: 12px;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #1a7742;
            color: #1a7742;
        }

        body.dark-theme .btn-outline {
            color: #7ccf9c;
            border-color: #7ccf9c;
        }

        /* –ö—Ä–∞—Å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Å–ø–∏—Å–∞–Ω–∏—è */
        .btn-danger {
            background: #dc3545;
            border: none;
            color: white;
        }

        .btn-danger:hover {
            background: #b02a37;
        }

        .btn-small {
            padding: 10px 16px;
            font-size: 0.9rem;
            width: auto;
        }

        .balance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .btn-transfers {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.4);
            color: white;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            backdrop-filter: blur(4px);
        }

        .btn-transfers:hover {
            background: rgba(255,255,255,0.3);
        }

        .balance-card {
            background: linear-gradient(145deg, #1a7742, #135c33);
            color: white;
            padding: 24px;
            border-radius: 28px;
            margin-bottom: 24px;
        }

        .balance-label {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .balance-amount {
            font-size: 3rem;
            font-weight: 600;
            line-height: 1.2;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
        }

        .transactions-list {
            list-style: none;
            margin-bottom: 30px;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid #eaeaea;
        }

        body.dark-theme .transaction-item {
            border-bottom-color: #333;
        }

        .transaction-left {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .transaction-comment {
            font-weight: 500;
        }

        .transaction-meta {
            font-size: 0.8rem;
            color: #888;
        }

        .transaction-amount {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .income {
            color: #28a745;
        }

        .outcome {
            color: #dc3545;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #333;
        }

        body.dark-theme .form-group label {
            color: #ccc;
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 30px;
            font-size: 1rem;
            background: #fafafa;
        }

        body.dark-theme .form-control {
            background: #2d2d2d;
            border-color: #444;
            color: #f0f0f0;
        }

        .form-control:focus {
            outline: none;
            border-color: #1a7742;
        }

        .warning {
            color: #dc3545;
            font-size: 0.9rem;
            margin-bottom: 12px;
        }

        .nav-row {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .back-btn {
            background: none;
            border: none;
            color: #1a7742;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            margin-bottom: 16px;
        }

        .hidden {
            display: none !important;
        }

        .mt-4 {
            margin-top: 24px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="header">
            <h2 id="header-title">–°–±–µ—Ä–±–∞–Ω–∫</h2>
            <button class="theme-switch" id="themeToggle">
                <span>üåô</span> –¢–µ–º–∞
            </button>
        </div>

        <div class="content" id="contentArea">
            <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ -->
            <div id="accountSelectionScreen">
                <div class="account-selector">
                    <div class="account-card" data-account="mikhail">
                        <div class="avatar">–ú</div>
                        <div class="account-info">
                            <h3>–ú–∏—Ö–∞–∏–ª –°.</h3>
                            <p>–°—á—ë—Ç ¬∑ ‚ÇΩ</p>
                        </div>
                    </div>
                    <div class="account-card" data-account="nikolay">
                        <div class="avatar">–ù</div>
                        <div class="account-info">
                            <h3>–ù–∏–∫–æ–ª–∞–π</h3>
                            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –≠–∫—Ä–∞–Ω –ú–∏—Ö–∞–∏–ª–∞ -->
            <div id="mikhailScreen" class="hidden">
                <button class="back-btn" id="backFromMikhail">‚Üê –ù–∞–∑–∞–¥</button>
                <div class="balance-card">
                    <div class="balance-header">
                        <span class="balance-label">–ë–∞–ª–∞–Ω—Å —Å—á—ë—Ç–∞</span>
                        <button class="btn-transfers" id="mikhailTransferBtn">–ü–µ—Ä–µ–≤–æ–¥—ã</button>
                    </div>
                    <div class="balance-amount" id="mikhailBalance">0 ‚ÇΩ</div>
                </div>

                <div class="section-title">
                    <span>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</span>
                    <span>(–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10)</span>
                </div>
                <ul class="transactions-list" id="mikhailTransactions"></ul>
            </div>

            <!-- –≠–∫—Ä–∞–Ω –ù–∏–∫–æ–ª–∞—è -->
            <div id="nikolayScreen" class="hidden">
                <button class="back-btn" id="backFromNikolay">‚Üê –ù–∞–∑–∞–¥</button>
                <h3 style="margin-bottom: 20px;">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h3>

                <button class="btn" id="nikolayTransferToMikhail">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –ú–∏—Ö–∞–∏–ª—É</button>
                <button class="btn btn-danger" id="nikolayDebitFromMikhail">–°–ø–∏—Å–∞—Ç—å —É –ú–∏—Ö–∞–∏–ª–∞</button>
                <button class="btn btn-outline" id="nikolayClearMikhail">–û—á–∏—Å—Ç–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç –ú–∏—Ö–∞–∏–ª–∞</button>

                <!-- –§–æ—Ä–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ –ù–∏–∫–æ–ª–∞—è (–∑–∞—á–∏—Å–ª–µ–Ω–∏–µ) -->
                <div id="nikolayTransferForm" class="hidden mt-4">
                    <h4>–ü–µ—Ä–µ–≤–æ–¥ –ú–∏—Ö–∞–∏–ª—É</h4>
                    <div class="form-group">
                        <label>–ò–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è</label>
                        <input type="text" id="senderName" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–∏–∫–æ–ª–∞–π" value="–ù–∏–∫–æ–ª–∞–π">
                    </div>
                    <div class="form-group">
                        <label>–°—É–º–º–∞ (‚ÇΩ)</label>
                        <input type="number" id="transferAmountNik" class="form-control" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                        <input type="text" id="transferCommentNik" class="form-control" placeholder="–ü–æ–¥–∞—Ä–æ–∫">
                    </div>
                    <button class="btn" id="executeNikolayTransfer">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
                    <button class="btn btn-outline" id="cancelNikolayTransfer">–û—Ç–º–µ–Ω–∞</button>
                </div>

                <!-- –§–æ—Ä–º–∞ —Å–ø–∏—Å–∞–Ω–∏—è (–¥–µ–±–µ—Ç) -->
                <div id="nikolayDebitForm" class="hidden mt-4">
                    <h4 style="color: #dc3545;">–°–ø–∏—Å–∞—Ç—å —É –ú–∏—Ö–∞–∏–ª–∞</h4>
                    <div class="form-group">
                        <label>–°—É–º–º–∞ —Å–ø–∏—Å–∞–Ω–∏—è (‚ÇΩ)</label>
                        <input type="number" id="debitAmount" class="form-control" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                        <input type="text" id="debitComment" class="form-control" placeholder="–û—Å–Ω–æ–≤–∞–Ω–∏–µ">
                    </div>
                    <button class="btn btn-danger" id="executeDebit">–°–ø–∏—Å–∞—Ç—å</button>
                    <button class="btn btn-outline" id="cancelDebit">–û—Ç–º–µ–Ω–∞</button>
                </div>

                <!-- –§–æ—Ä–º–∞ –æ—á–∏—Å—Ç–∫–∏ (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ) -->
                <div id="nikolayClearForm" class="hidden mt-4">
                    <div class="warning">–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –ü–û–î–¢–í–ï–†–î–ò–¢–¨ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏</div>
                    <input type="text" id="confirmClearInput" class="form-control" placeholder="–ü–û–î–¢–í–ï–†–î–ò–¢–¨">
                    <div class="nav-row">
                        <button class="btn" id="executeClear">–û—á–∏—Å—Ç–∏—Ç—å</button>
                        <button class="btn btn-outline" id="cancelClear">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            </div>

            <!-- –≠–∫—Ä–∞–Ω –ø–µ—Ä–µ–≤–æ–¥–∞ (–ú–∏—Ö–∞–∏–ª) -->
            <div id="transferScreen" class="hidden">
                <button class="back-btn" id="backFromTransfer">‚Üê –ü–µ—Ä–µ–≤–æ–¥—ã</button>
                <h3 style="margin-bottom: 20px;">–ü–µ—Ä–µ–≤–æ–¥ –¥–µ–Ω–µ–≥</h3>
                <div class="form-group">
                    <label>–ù–æ–º–µ—Ä —Å—á–µ—Ç–∞ (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)</label>
                    <input type="text" id="accountNumber" class="form-control" placeholder="2200 0000 0000 0000">
                </div>
                <div class="form-group">
                    <label>–°—É–º–º–∞ (‚ÇΩ)</label>
                    <input type="number" id="transferAmount" class="form-control" placeholder="0">
                </div>
                <div class="form-group">
                    <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="text" id="transferComment" class="form-control" placeholder="–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ">
                </div>
                <button class="btn" id="executeTransfer">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –¥–µ–Ω—å–≥–∏</button>
            </div>
        </div>
    </div>

    <script>
        // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAu_wfaRhTsWNbsyFYmEigopqJck7ynxlU",
            authDomain: "messeger-0wo2h4.firebaseapp.com",
            databaseURL: "https://messeger-0wo2h4-default-rtdb.firebaseio.com",
            projectId: "messeger-0wo2h4",
            storageBucket: "messeger-0wo2h4.firebasestorage.app",
            messagingSenderId: "1057251395030",
            appId: "1:1057251395030:web:86f8f718ed938055e29077"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 2. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentUser = null;
        let mikhailData = null;
        let nikolayData = null;

        // –°—Å—ã–ª–∫–∏ –Ω–∞ DOM
        const accountSelScreen = document.getElementById('accountSelectionScreen');
        const mikhailScreen = document.getElementById('mikhailScreen');
        const nikolayScreen = document.getElementById('nikolayScreen');
        const transferScreen = document.getElementById('transferScreen');
        const headerTitle = document.getElementById('header-title');

        // 3. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

        function getMoscowDateTime() {
            const now = new Date();
            const mskTime = new Date(now.toLocaleString('en-US', { timeZone: 'Europe/Moscow' }));
            const date = mskTime.toISOString().slice(0, 10);
            const time = mskTime.toTimeString().slice(0, 5);
            return { date, time };
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Firebase
        function loadUserData(callback) {
            const usersRef = db.ref('users');
            usersRef.once('value', (snapshot) => {
                const data = snapshot.val() || {};
                if (!data.mikhail) {
                    data.mikhail = {
                        balance: 5000,
                        registrationDate: new Date().toISOString().slice(0, 10),
                        theme: 'light',
                        transactions: []
                    };
                } else {
                    // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
                    if (data.mikhail.transactions) {
                        data.mikhail.transactions.sort((a, b) => {
                            if (a.date === b.date) return b.time.localeCompare(a.time);
                            return b.date.localeCompare(a.date);
                        });
                    }
                }
                if (!data.nikolay) {
                    data.nikolay = { theme: 'light' };
                }

                mikhailData = data.mikhail;
                nikolayData = data.nikolay;
                usersRef.set(data).then(() => {
                    if (callback) callback();
                });
            });
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ú–∏—Ö–∞–∏–ª–∞ (–æ–±—ã—á–Ω—ã–π set)
        function saveMikhailData() {
            return db.ref('users/mikhail').set(mikhailData);
        }

        function applyTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.add('dark-theme');
            } else {
                document.body.classList.remove('dark-theme');
            }
        }

        function loadThemeForUser(user) {
            if (user === 'mikhail' && mikhailData) {
                applyTheme(mikhailData.theme || 'light');
            } else if (user === 'nikolay' && nikolayData) {
                applyTheme(nikolayData.theme || 'light');
            }
        }

        function toggleTheme() {
            if (!currentUser) return;
            const newTheme = document.body.classList.contains('dark-theme') ? 'light' : 'dark';
            if (currentUser === 'mikhail') {
                mikhailData.theme = newTheme;
                saveMikhailData().then(() => {
                    applyTheme(newTheme);
                });
            } else if (currentUser === 'nikolay') {
                nikolayData.theme = newTheme;
                db.ref('users/nikolay/theme').set(newTheme).then(() => {
                    applyTheme(newTheme);
                });
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ú–∏—Ö–∞–∏–ª–∞
        function renderMikhail() {
            if (!mikhailData) return;
            document.getElementById('mikhailBalance').innerText = mikhailData.balance.toLocaleString() + ' ‚ÇΩ';
            const transactions = (mikhailData.transactions || []).slice(0, 10);
            const tbody = document.getElementById('mikhailTransactions');
            tbody.innerHTML = '';
            transactions.forEach(t => {
                const li = document.createElement('li');
                li.className = 'transaction-item';
                const sign = t.type === 'income' ? '+' : '-';
                const amountClass = t.type === 'income' ? 'income' : 'outcome';
                li.innerHTML = `
                    <div class="transaction-left">
                        <span class="transaction-comment">${t.comment || (t.type === 'income' ? '–ó–∞—á–∏—Å–ª–µ–Ω–∏–µ' : '–ü–µ—Ä–µ–≤–æ–¥')}</span>
                        <span class="transaction-meta">${t.date} ${t.time} ‚Ä¢ ${t.counterparty || ''}</span>
                    </div>
                    <span class="transaction-amount ${amountClass}">${sign}${t.amount} ‚ÇΩ</span>
                `;
                tbody.appendChild(li);
            });
            if (transactions.length === 0) {
                tbody.innerHTML = '<li style="text-align:center;padding:20px;color:#888;">–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</li>';
            }
        }

        function showScreen(screenName) {
            accountSelScreen.classList.add('hidden');
            mikhailScreen.classList.add('hidden');
            nikolayScreen.classList.add('hidden');
            transferScreen.classList.add('hidden');
            document.getElementById('nikolayTransferForm').classList.add('hidden');
            document.getElementById('nikolayDebitForm').classList.add('hidden');
            document.getElementById('nikolayClearForm').classList.add('hidden');

            if (screenName === 'account') {
                accountSelScreen.classList.remove('hidden');
                headerTitle.innerText = '–°–±–µ—Ä–±–∞–Ω–∫';
                currentUser = null;
            } else if (screenName === 'mikhail') {
                mikhailScreen.classList.remove('hidden');
                headerTitle.innerText = '–ú–∏—Ö–∞–∏–ª –°.';
                renderMikhail();
            } else if (screenName === 'nikolay') {
                nikolayScreen.classList.remove('hidden');
                headerTitle.innerText = '–ù–∏–∫–æ–ª–∞–π';
            } else if (screenName === 'transfer') {
                transferScreen.classList.remove('hidden');
            }
        }

        // 4. –°–æ–±—ã—Ç–∏—è –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            loadUserData(() => {
                showScreen('account');
            });

            document.getElementById('themeToggle').addEventListener('click', toggleTheme);

            document.querySelectorAll('.account-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    const account = card.dataset.account;
                    currentUser = account;
                    loadUserData(() => {
                        loadThemeForUser(account);
                        if (account === 'mikhail') {
                            showScreen('mikhail');
                        } else {
                            showScreen('nikolay');
                        }
                    });
                });
            });

            document.getElementById('backFromMikhail').addEventListener('click', () => showScreen('account'));
            document.getElementById('backFromNikolay').addEventListener('click', () => showScreen('account'));
            document.getElementById('backFromTransfer').addEventListener('click', () => showScreen('mikhail'));

            // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —É –ú–∏—Ö–∞–∏–ª–∞
            document.getElementById('mikhailTransferBtn').addEventListener('click', () => {
                showScreen('transfer');
            });

            // –ü–µ—Ä–µ–≤–æ–¥ –æ—Ç –ú–∏—Ö–∞–∏–ª–∞
            document.getElementById('executeTransfer').addEventListener('click', () => {
                const account = document.getElementById('accountNumber').value.trim();
                const amount = parseFloat(document.getElementById('transferAmount').value);
                const comment = document.getElementById('transferComment').value.trim() || '–ü–µ—Ä–µ–≤–æ–¥';

                if (!account || !/^\d+$/.test(account)) {
                    alert('–ù–æ–º–µ—Ä —Å—á–µ—Ç–∞ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã');
                    return;
                }
                if (isNaN(amount) || amount <= 0) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
                    return;
                }
                if (amount > mikhailData.balance) {
                    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
                    return;
                }

                const { date, time } = getMoscowDateTime();
                mikhailData.balance -= amount;
                if (!mikhailData.transactions) mikhailData.transactions = [];
                mikhailData.transactions.unshift({
                    type: 'outcome',
                    amount: amount,
                    date: date,
                    time: time,
                    comment: comment,
                    counterparty: `–°—á–µ—Ç ${account.slice(0,4)}...`
                });
                saveMikhailData().then(() => {
                    renderMikhail();
                    showScreen('mikhail');
                    document.getElementById('accountNumber').value = '';
                    document.getElementById('transferAmount').value = '';
                    document.getElementById('transferComment').value = '';
                });
            });

            // –ù–∏–∫–æ–ª–∞–π: –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –ø–µ—Ä–µ–≤–æ–¥–∞
            document.getElementById('nikolayTransferToMikhail').addEventListener('click', () => {
                document.getElementById('nikolayTransferForm').classList.remove('hidden');
                document.getElementById('nikolayDebitForm').classList.add('hidden');
            });
            document.getElementById('cancelNikolayTransfer').addEventListener('click', () => {
                document.getElementById('nikolayTransferForm').classList.add('hidden');
            });

            // –ù–∏–∫–æ–ª–∞–π: –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É —Å–ø–∏—Å–∞–Ω–∏—è
            document.getElementById('nikolayDebitFromMikhail').addEventListener('click', () => {
                document.getElementById('nikolayDebitForm').classList.remove('hidden');
                document.getElementById('nikolayTransferForm').classList.add('hidden');
            });
            document.getElementById('cancelDebit').addEventListener('click', () => {
                document.getElementById('nikolayDebitForm').classList.add('hidden');
            });

            // –ù–∏–∫–æ–ª–∞–π: –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ (–∑–∞—á–∏—Å–ª–µ–Ω–∏–µ) - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
            document.getElementById('executeNikolayTransfer').addEventListener('click', () => {
                const sender = document.getElementById('senderName').value.trim() || '–ù–∏–∫–æ–ª–∞–π';
                const amount = parseFloat(document.getElementById('transferAmountNik').value);
                const comment = document.getElementById('transferCommentNik').value.trim() || '–ü–µ—Ä–µ–≤–æ–¥';

                if (isNaN(amount) || amount <= 0) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
                    return;
                }

                const { date, time } = getMoscowDateTime();
                const mikhailRef = db.ref('users/mikhail');
                mikhailRef.transaction((currentData) => {
                    if (currentData === null) return currentData;
                    currentData.balance = (currentData.balance || 0) + amount;
                    if (!currentData.transactions) currentData.transactions = [];
                    currentData.transactions.unshift({
                        type: 'income',
                        amount: amount,
                        date: date,
                        time: time,
                        comment: `–û—Ç ${sender}: ${comment}`,
                        counterparty: sender
                    });
                    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–ª—è –ø–æ—Ä—è–¥–∫–∞ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
                    currentData.transactions.sort((a, b) => {
                        if (a.date === b.date) return b.time.localeCompare(a.time);
                        return b.date.localeCompare(a.date);
                    });
                    return currentData;
                }).then((result) => {
                    if (result.committed) {
                        mikhailData = result.snapshot.val();
                        alert('–ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω');
                        document.getElementById('nikolayTransferForm').classList.add('hidden');
                        document.getElementById('transferAmountNik').value = '';
                        document.getElementById('transferCommentNik').value = '';
                    } else {
                        alert('–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞');
                    }
                }).catch((error) => {
                    console.error(error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ');
                });
            });

            // –ù–∏–∫–æ–ª–∞–π: –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–ø–∏—Å–∞–Ω–∏–µ (–¥–µ–±–µ—Ç) - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
            document.getElementById('executeDebit').addEventListener('click', () => {
                const amount = parseFloat(document.getElementById('debitAmount').value);
                const comment = document.getElementById('debitComment').value.trim() || '–°–ø–∏—Å–∞–Ω–∏–µ';

                if (isNaN(amount) || amount <= 0) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
                    return;
                }

                const { date, time } = getMoscowDateTime();
                const mikhailRef = db.ref('users/mikhail');
                mikhailRef.transaction((currentData) => {
                    if (currentData === null) return currentData;
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —Å—Ä–µ–¥—Å—Ç–≤
                    if ((currentData.balance || 0) < amount) {
                        return; // abort transaction
                    }
                    currentData.balance -= amount;
                    if (!currentData.transactions) currentData.transactions = [];
                    currentData.transactions.unshift({
                        type: 'outcome',
                        amount: amount,
                        date: date,
                        time: time,
                        comment: `–°–ø–∏—Å–∞–Ω–∏–µ: ${comment}`,
                        counterparty: '–ù–∏–∫–æ–ª–∞–π (—Å–ø–∏—Å–∞–Ω–∏–µ)'
                    });
                    currentData.transactions.sort((a, b) => {
                        if (a.date === b.date) return b.time.localeCompare(a.time);
                        return b.date.localeCompare(a.date);
                    });
                    return currentData;
                }).then((result) => {
                    if (result.committed) {
                        mikhailData = result.snapshot.val();
                        alert('–°–ø–∏—Å–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ');
                        document.getElementById('nikolayDebitForm').classList.add('hidden');
                        document.getElementById('debitAmount').value = '';
                        document.getElementById('debitComment').value = '';
                    } else {
                        alert('–û—à–∏–±–∫–∞: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω—ã');
                    }
                }).catch((error) => {
                    console.error(error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏');
                });
            });

            // –ù–∏–∫–æ–ª–∞–π: –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –æ—á–∏—Å—Ç–∫–∏
            document.getElementById('nikolayClearMikhail').addEventListener('click', () => {
                document.getElementById('nikolayClearForm').classList.remove('hidden');
                document.getElementById('nikolayTransferForm').classList.add('hidden');
                document.getElementById('nikolayDebitForm').classList.add('hidden');
            });
            document.getElementById('cancelClear').addEventListener('click', () => {
                document.getElementById('nikolayClearForm').classList.add('hidden');
                document.getElementById('confirmClearInput').value = '';
            });

            // –ù–∏–∫–æ–ª–∞–π: –æ—á–∏—Å—Ç–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç –ú–∏—Ö–∞–∏–ª–∞ (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è)
            document.getElementById('executeClear').addEventListener('click', () => {
                const confirmText = document.getElementById('confirmClearInput').value.trim();
                if (confirmText !== '–ü–û–î–¢–í–ï–†–î–ò–¢–¨') {
                    alert('–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –ü–û–î–¢–í–ï–†–î–ò–¢–¨ —Ç–æ—á–Ω–æ');
                    return;
                }

                const mikhailRef = db.ref('users/mikhail');
                mikhailRef.transaction((currentData) => {
                    if (currentData === null) return currentData;
                    currentData.balance = 0;
                    currentData.transactions = [];
                    return currentData;
                }).then((result) => {
                    if (result.committed) {
                        mikhailData = result.snapshot.val();
                        alert('–ê–∫–∫–∞—É–Ω—Ç –ú–∏—Ö–∞–∏–ª–∞ –æ—á–∏—â–µ–Ω');
                        document.getElementById('nikolayClearForm').classList.add('hidden');
                        document.getElementById('confirmClearInput').value = '';
                    } else {
                        alert('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞');
                    }
                });
            });
        });
    </script>
</body>
</html>
